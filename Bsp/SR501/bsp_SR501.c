/***********************************************************************************************************************************
 ** 【文件名称】  bsp_SR501.c
 **
 ** 【文件功能】  HC-SR501人体红外感应模块驱动
 **
 ** 【模块说明】  HC-SR501是一款基于热释电效应的人体红外感应模块
 **               特点：
 **               - 自动感应：人进入感应范围则输出高电平，人离开感应范围则自动延时关闭高电平
 **               - 感应距离：3-7米（可调）
 **               - 延时时间：5-200秒（可调）
 **               - 阻塞时间：默认2.5秒
 **               - 工作电压：DC 4.5V-20V
 **               - 输出电平：高3.3V，低0V
 **               - 触发方式：L不可重复触发/H可重复触发（跳线选择）
 **
 ** 【硬件连接】  VCC  -> 5V
 **               GND  -> GND
 **               OUT  -> PC12 (SR501_IN)
 **
 ** 【适用平台】  STM32F103 + HAL库
 **
************************************************************************************************************************************/

#include "bsp_SR501.h"

/******************************************************************************
 * 函  数： SR501_Init
 * 功  能： 初始化HC-SR501人体红外感应模块
 * 参  数： GPIO_TypeDef *GPIOx    GPIO端口
 *          uint16_t GPIO_Pin      GPIO引脚
 * 返回值： 无
 * 备  注： 由于GPIO已在MX_GPIO_Init()中初始化为输入上拉模式，
 *          本函数主要用于后续功能扩展（如外部中断模式）
 ******************************************************************************/
void SR501_Init(GPIO_TypeDef *GPIOx, uint16_t GPIO_Pin)
{
    // GPIO已在gpio.c的MX_GPIO_Init()中完成初始化
    // 配置为：GPIO_MODE_INPUT, GPIO_PULLUP
    // 此处保留用于后续功能扩展
    
    // 可选：添加初始化延时，等待传感器稳定（HC-SR501上电后需约1分钟预热）
    // 注意：实际使用时建议在系统启动后延时一段时间再开始检测
}

/******************************************************************************
 * 函  数： SR501_Read
 * 功  能： 读取HC-SR501传感器状态
 * 参  数： GPIO_TypeDef *GPIOx    GPIO端口
 *          uint16_t GPIO_Pin      GPIO引脚
 * 返回值： SR501_Status_t
 *          SR501_NO_MOTION       - 未检测到人体运动（引脚为低电平）
 *          SR501_MOTION_DETECTED - 检测到人体运动（引脚为高电平）
 * 备  注： HC-SR501工作原理：
 *          - 检测到人体红外信号变化时，OUT引脚输出高电平（3.3V）
 *          - 未检测到人体或延时时间到后，OUT引脚输出低电平（0V）
 *          - 读取引脚电平即可判断是否有人体存在
 ******************************************************************************/
SR501_Status_t SR501_Read(GPIO_TypeDef *GPIOx, uint16_t GPIO_Pin)
{
    GPIO_PinState pin_state;
    
    // 读取GPIO引脚电平
    pin_state = HAL_GPIO_ReadPin(GPIOx, GPIO_Pin);
    
    // 高电平表示检测到人体，低电平表示无人体
    if (pin_state == GPIO_PIN_SET)
    {
        return SR501_MOTION_DETECTED;  // 检测到人体
    }
    else
    {
        return SR501_NO_MOTION;        // 未检测到人体
    }
}

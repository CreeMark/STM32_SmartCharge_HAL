/***********************************************************************************************************************************
 ** 【文件名称】  bsp_fan.c
 **
 ** 【文件功能】  PWM风扇控制驱动
 **
 ** 【模块说明】  PWM调速风扇模块
 **               特点：
 **               - 3线风扇：VCC（5V）、GND、PWM（控制信号）
 **               - PWM控制：低电平有效（0V=全速运行，3.3V=停止/低速）
 **               - 简单控制：本驱动仅提供开关功能，不实现PWM调速
 **               - 工作电压：VCC=5V，PWM信号=3.3V
 **
 ** 【硬件连接】  VCC  -> 开发板5V
 **               GND  -> 开发板GND
 **               PWM  -> PC0 (FAN_PWM) - 低电平有效
 **
 ** 【使用说明】  1. 确保在main.c中已调用MX_GPIO_Init()
 **               2. 调用Fan_Init()进行初始化（可选，GPIO已配置）
 **               3. 使用Fan_Start()/Fan_Stop()控制风扇开关
 **
 ** 【适用平台】  STM32F103 + HAL库
 **
 ** 【作者信息】  Created on: 2025-10-21
 **
************************************************************************************************************************************/

#include "bsp_fan.h"

/* Private variables ---------------------------------------------------------*/
static Fan_Status_t fan_current_status = FAN_OFF;  // 风扇当前状态

/******************************************************************************
 * 函  数： Fan_Init
 * 功  能： 初始化PWM风扇控制引脚
 * 参  数： 无
 * 返回值： 无
 * 备  注： GPIO已在MX_GPIO_Init()中完成配置，本函数确保初始状态为关闭
 ******************************************************************************/
void Fan_Init(void)
{
    // 确保风扇初始状态为关闭（高电平）
    HAL_GPIO_WritePin(FAN_PWM_GPIO_PORT, FAN_PWM_GPIO_PIN, GPIO_PIN_SET);
    fan_current_status = FAN_OFF;
}

/******************************************************************************
 * 函  数： Fan_Start
 * 功  能： 启动风扇（全速运行）
 * 参  数： 无
 * 返回值： 无
 * 备  注： 对于低电平有效的PWM风扇，输出低电平启动风扇
 ******************************************************************************/
void Fan_Start(void)
{
    HAL_GPIO_WritePin(FAN_PWM_GPIO_PORT, FAN_PWM_GPIO_PIN, GPIO_PIN_RESET);  // 低电平=风扇全速
    fan_current_status = FAN_ON;
}

/******************************************************************************
 * 函  数： Fan_Stop
 * 功  能： 停止风扇
 * 参  数： 无
 * 返回值： 无
 * 备  注： 对于低电平有效的PWM风扇，输出高电平停止风扇
 ******************************************************************************/
void Fan_Stop(void)
{
    HAL_GPIO_WritePin(FAN_PWM_GPIO_PORT, FAN_PWM_GPIO_PIN, GPIO_PIN_SET);    // 高电平=风扇停止
    fan_current_status = FAN_OFF;
}

/******************************************************************************
 * 函  数： Fan_Toggle
 * 功  能： 切换风扇状态（开/关）
 * 参  数： 无
 * 返回值： 无
 * 备  注： 如果当前运行则停止，如果当前停止则启动
 ******************************************************************************/
void Fan_Toggle(void)
{
    if (fan_current_status == FAN_ON)
    {
        Fan_Stop();
    }
    else
    {
        Fan_Start();
    }
}

/******************************************************************************
 * 函  数： Fan_GetStatus
 * 功  能： 获取风扇当前状态
 * 参  数： 无
 * 返回值： FAN_OFF=0(关闭), FAN_ON=1(运行)
 * 备  注： 返回内部状态变量，不读取GPIO实际电平
 ******************************************************************************/
Fan_Status_t Fan_GetStatus(void)
{
    return fan_current_status;
}

/******************************************************************************
 * 函  数： Fan_SetStatus
 * 功  能： 设置风扇状态
 * 参  数： status - FAN_OFF或FAN_ON
 * 返回值： 无
 * 备  注： 根据目标状态调用相应的启动或停止函数
 ******************************************************************************/
void Fan_SetStatus(Fan_Status_t status)
{
    if (status == FAN_ON)
    {
        Fan_Start();
    }
    else
    {
        Fan_Stop();
    }
}

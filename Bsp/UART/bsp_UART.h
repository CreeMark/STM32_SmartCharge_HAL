#ifndef __BSP__UART_H
#define __BSP__UART_H
/***********************************************************************************************************************************
 ** �������д��  ħŮ�������Ŷ�
 ** ����    ����  ħŮ������       https://demoboard.taobao.com
 ***********************************************************************************************************************************
 ** ���ļ����ơ�  bsp_UART.h
 **
 ** �� ��  �� ��  ����ͨ�ŵײ�����(UART1��UART2��UART3��UART4��UART5��UART6)
 **               ������-None-8-1
 **               ����ȫ�������еĴ��ں�����������ɳ�ʼ�������͡�����.
 **
 ** �� Լ  �� ��  ���ļ����ô���ͨ�ţ���Ϊ�첽ͨ�š�
 **               2024������µ�ʾ��������ͨ�ź�������ʱ��ͳһʹ��"UART"������ʹ�þ��ļ��е�"USART".
 **
 ** ������ƽ̨��  STM32F103 + keil5 + ��׼��/��׼��
 **
 ** ���������š�  �������ڵĳ�ʼ������UARTx_Init()����������Ĭ�����Ž��г�ʼ����
 **               1- UART1  TX_PA9   RX_PA10       �ر�˵����ħŮ������ϵ�У�������USBתTTL��PCB�Ѳ������Ӻ�UART1, ʹ�ú���¼�õ�ͬһUSB�ӿڣ�����ͨ��UART1�͵��Խ���ͨ�š�����鿴�����ļ����е�˵���ļ���
 **               2- UART2  TX_PA2   RX_PA3
 **               3- UART3  TX_PB10  RX_PB11
 **               4- UART4  TX_PC10  RX_PC11
 **               5- UART5  TX_PC12  RX_PD2
 **               6- UART6  TX_PC6   RX_PC7
 **
 ** ����ֲ˵����  1- ���ʹ��CubeMX���õĹ��̣������UART�����κ����á�
 **               2- ������HAL�⡢��׼�⹤�̣�ͨ���������������ֱ��ʹ�á�
 **               3- ���Ʊ����̵�UART�ļ��У���Ŀ�깤���ļ�����;
 **               4- ����ͷ�ļ�·���� Keil > Option > C/C++ > Include Paths;
 **               5- ����C�ļ�������: Keil > ��๤�̹�������˫��Ŀ���ļ��� > ѡ�� bsp_UART.c;
 **               6- �����ļ�����:    #include "bsp_uart.h�������ĸ��ļ�Ҫ�ô��ڹ��ܣ�����������ļ�������������;
 **
 ** ������ʹ�á�  ÿ�鴮�ڣ��ѷ�װ��7������ (��ʼ��1��������3��������3��)��������UART1��ʾ��˵����               
 **               1����ʼ��:             void      UART1_Init(uint32_t ulBaudrate);                                      // ��ʼ������; ����GPIO����PA9+PA10������ͨ�Ų�����������-None-8-1�������ж�
 **               2������ָ�����ȵ�����  void      UART1_SendData(uint8_t *puData, uint16_t usNum);                      // ����ָ�����ȵ�����; ���������ݵ�ַ���ֽ���
 **               3�������ַ���          void      UART1_SendString(const char *pcString,...);                           // �����ַ���;   �������ַ�����ַ; ʹ�÷�����ͬprintf
 **               4������ATָ��          uint8_t   UART1_SendAT(char *pcAT, char *pcAckString, uint16_t usTimeOutMs);    // �����������ESP8266������ģ���AT�̼������ڵȴ������ڴ�����Ϣ; ������ATָ���ַ������ڴ�������Ϣ�ַ�����ms�ȴ���ʱ; ���أ�0-ִ��ʧ�ܡ�1-ִ�гɹ� 
 **               5����ȡ���յ��ֽ���:   uint16_t  UART1_GetRxNum(void);                                                 // ��ȡ���յ����ֽ���; �������ֵ����0����Ϊ���յ���һ֡����
 **               6����ȡ���յ����ݣ�    uint8_t*  UART1_GetRxData(void);                                                // ��ȡ���յ�������(����ĵ�ַ)
 **               7��������ձ�־��      void      UART1_ClearRx(void);                                                  // ��0���ձ�־������0���յ����ֽ���; ÿ�δ���������ݣ���Ҫ�������������0�����ɽ������ֽ����ж�
 **
 ** �����¼�¼��  2024-07-02  ����Modbus_CRC16У���׷�ӡ��жϺ���
 **               2024-06-30  �Ż�UART��ʼ����������żУ��3���Ĵ���λ�Ĵ���������
 **               2024-06-20  �Ż�ATָ���, ���Ʒ����ȴ�����; ȡ��:UARTx_WaitACK();
 **               2024-06-07  ����ATָ��ȴ���������������UARTx_WaitACK();
 **               2024-06-07  �Ż�������UARTx_SendString();
 **               2024-06-06  �Ż��������䣬ʹ�ļ��������ڱ�׼�⡢HAL�⹤��
 **               2024-04-04  UARTx_SendString()��ȡ����ʱ�����static���Լ���RAMռ�ã�����LVGL��ֲ;
 **               2024-03-27  �޸�xUSATR_TypeDef�ṹ�壬�Ż�����Ĵ洢��ʽ
 **               2024-02-04  �򻯽��պ�����������������ʹ��Rx�ַ�������ɺ��������е�Reveived�ַ�;
 **               2024-01-09  ȡ�����־�̬����������ṹ���У�ʹ�õ��ø�ֱ��
 **               2024-01-03  ���ƺ�����ע��
 **               2023-12-25  ���ӽ��պ����ķ�װ��ȡ�����ձ���(ȫ��)��ʹ��
 **               2023-12-23  ��ɶ�HAL���֧��
 **               2023-01-27  ���Ӻ궨�塢����ע��
 **               2021-12-16  ���ƽ��ջ��ƣ�ȡ�����ձ�־���жϽ����ֽ���>0��Ϊ���յ�������
 **               2021-11-03  ���ƽ��պ�������ֵ����
 **               2021-08-14  ���Ӻ궨�壺���ջ�������С�趨ֵ��ʹ�ռ�ռ�ø��ɿأ�
 **               2021-08-14  �޸ķ��ͺ������ƣ�UARTx_Printf()���޸�Ϊ��UARTx_SendString();
 **               2020-09-02  �ļ�������UART1�����жϡ������жϡ������жϡ�DMA�շ�
 **               2021-06-04  UART1��2��3��UART4��5 ���շ����ƴ���
 **               2021-06-09  �����ļ���ʽ��ע��
 **               2021-06-22  ����ע��˵��
 **
************************************************************************************************************************************/
#include "stdio.h"
#include "string.h"

#ifdef USE_STDPERIPH_DRIVER
    #include "stm32f10x.h"                       // ��׼��
#endif

#ifdef USE_HAL_DRIVER
    #include "stm32f1xx_hal.h"                   // HAL��
#endif


/*****************************************************************************
 ** ��ֲ�����޸���
 ** ��ע������������Ҫ�󣬷������������ͨ��������ͨ�š�ESP8266ͨ�š���������
****************************************************************************/
// ���ڿ���
#define UART1_EN                       1          // ����1��0=�ء�1=����;  ����û�õ�USART1, ��0���Ͳ��Ὺ��USART1���ͻ��桢���ջ��棬ʡһ����Դ;
#define UART2_EN                       1          // ����2��0=�ء�1=����;  ͬ��;
#define UART3_EN                       1          // ����3��0=�ء�1=����;  ͬ��;
#define UART4_EN                       1          // ����4��0=�ء�1=����;  ͬ��;
#define UART5_EN                       1          // ����5��0=�ء�1=����;  ͬ��;
// ���ͻ�������С                                 
#define UART1_TX_BUF_SIZE           2048          // ����ÿ��USART���ͻ��λ���������Ĵ�С����λ���ֽ���; 
#define UART2_TX_BUF_SIZE            512          // -- ֻ����ǰ�洮�ڿ����ڴ�״̬���Żᶨ�����Ļ���������
#define UART3_TX_BUF_SIZE            512          // -- Ĭ��ֵ��512����ֵ��������󲿳�����ͨ��; �����ESP8266֮����豸ͨ�ţ����ʵ������ֵ��
#define UART4_TX_BUF_SIZE            512          // -- ֵ��Χ��1~65535; ע���ʼ���󣬲�Ҫ����оƬ���RAMֵ��
#define UART5_TX_BUF_SIZE            512          // -- ע���ֵ��һ�����λ�������С������ÿһ֡���֡���ݽ��뷢��ǰ���ܻ����ֽ������Ƚ��ȳ���
// ���ջ�������С                                 
#define UART1_RX_BUF_SIZE            512          // ����ÿ��USART���ջ������Ĵ�С����λ���ֽ�; ��ֵӰ�췶Χ���ж���Ľ��ջ����С�����պ����ݻ���Ĵ�С
#define UART2_RX_BUF_SIZE            512          // --- �����յ���һ֡�����ֽ�����С�ڴ�ֵʱ������������
#define UART3_RX_BUF_SIZE            512          // --- �����յ���һ֡�����ֽ�����������ֵʱ���������֣������ж���ֱ�����ᣬֱ����֡���ս���(���������ж�); 
#define UART4_RX_BUF_SIZE            512          // 
#define UART5_RX_BUF_SIZE            512          // 
// ����-�����޸�



/*****************************************************************************
 ** ����ȫ�ֺ���
 **
 ** ÿ�����ڵĺ���:
 ** ��ʼ��    1��   ������-None-8-1
 ** ����      3��   ����ָ���������ݡ��ַ�����ATָ�� 
 ** ����      3��   ��ȡ�ֽ�������ȡ���ݡ���0
****************************************************************************/
// UART1
void      UART1_Init(uint32_t ulBaudrate);                                      // ��ʼ������1; GPIO����PA9+PA10���ж����ȼ���ͨ�Ų����������ʿ��衢8λ���ݡ���У�顢1��ֹͣλ
void      UART1_SendData(uint8_t *puData, uint16_t usNum);                      // ����ָ������; ���������ݵ�ַ���ֽ���
void      UART1_SendString(const char *pcString, ...);                          // �����ַ���;   �������ַ�����ַ; ʹ�÷�����ͬprintf
uint8_t   UART1_SendAT(char *pcAT, char *pcAckString, uint16_t usTimeOutMs);    // �����������ESP8266������ģ���AT�̼������ڵȴ������ڴ�����Ϣ; ������ATָ���ַ������ڴ�������Ϣ�ַ�����ms�ȴ���ʱ; ���أ�0-ִ��ʧ�ܡ�1-ִ�гɹ� 
uint16_t  UART1_GetRxNum(void);                                                 // ��ȡ���յ�������һ֡�ֽ���
uint8_t * UART1_GetRxData(void);                                                // ��ȡ���յ������� (����ĵ�ַ)
void      UART1_ClearRx(void);                                                  // �������յ������� (�������һ֡�ֽ�������Ϊ�����жϽ��յı�־)
// UART2                                                                        
void      UART2_Init(uint32_t ulBaudrate);                                      // ��ʼ������2; GPIO����PA2+PA3���ж����ȼ���ͨ�Ų����������ʿ��衢8λ���ݡ���У�顢1��ֹͣλ
void      UART2_SendData(uint8_t *puData, uint16_t usNum);                      // ����ָ������; ���������ݵ�ַ���ֽ���
void      UART2_SendString(const char *pcString, ...);                          // �����ַ���;   �������ַ�����ַ; ʹ�÷�����ͬprintf
uint8_t   UART2_SendAT(char *pcAT, char *pcAckString, uint16_t usTimeOutMs);    // �����������ESP8266������ģ���AT�̼������ڵȴ������ڴ�����Ϣ; ������ATָ���ַ������ڴ�������Ϣ�ַ�����ms�ȴ���ʱ; ���أ�0-ִ��ʧ�ܡ�1-ִ�гɹ� 
uint16_t  UART2_GetRxNum(void);                                                 // ��ȡ���յ�������һ֡�ֽ���
uint8_t * UART2_GetRxData(void);                                                // ��ȡ���յ������� (����ĵ�ַ)
void      UART2_ClearRx(void);                                                  // �������յ������� (�������һ֡�ֽ�������Ϊ�����жϽ��յı�־)
// UART3                                                                        
void      UART3_Init(uint32_t ulBaudrate);                                      // ��ʼ������3; GPIO����PB10+PB11���ж����ȼ���ͨ�Ų����������ʿ��衢8λ���ݡ���У�顢1��ֹͣλ
void      UART3_SendData(uint8_t *puData, uint16_t usNum);                      // ����ָ������; ���������ݵ�ַ���ֽ���
void      UART3_SendString(const char *pcString, ...);                          // �����ַ���;   �������ַ�����ַ; ʹ�÷�����ͬprintf
uint8_t   UART3_SendAT(char *pcAT, char *pcAckString, uint16_t usTimeOutMs);    // �����������ESP8266������ģ���AT�̼������ڵȴ������ڴ�����Ϣ; ������ATָ���ַ������ڴ�������Ϣ�ַ�����ms�ȴ���ʱ; ���أ�0-ִ��ʧ�ܡ�1-ִ�гɹ� 
uint16_t  UART3_GetRxNum(void);                                                 // ��ȡ���յ�������һ֡�ֽ���
uint8_t * UART3_GetRxData(void);                                                // ��ȡ���յ������� (����ĵ�ַ)
void      UART3_ClearRx(void);                                                  // �������յ������� (�������һ֡�ֽ�������Ϊ�����жϽ��յı�־)
// UART4                                                            
void      UART4_Init(uint32_t ulBaudrate);                                      // ��ʼ������4; GPIO����PC10+PC11���ж����ȼ���ͨ�Ų����������ʿ��衢8λ���ݡ���У�顢1��ֹͣλ
void      UART4_SendData(uint8_t *puData, uint16_t usNum);                      // ����ָ������; ���������ݵ�ַ���ֽ���
void      UART4_SendString(const char *pcString, ...);                          // �����ַ���;   �������ַ�����ַ; ʹ�÷�����ͬprintf
uint8_t   UART4_SendAT(char *pcAT, char *pcAckString, uint16_t usTimeOutMs);    // �����������ESP8266������ģ���AT�̼������ڵȴ������ڴ�����Ϣ; ������ATָ���ַ������ڴ�������Ϣ�ַ�����ms�ȴ���ʱ; ���أ�0-ִ��ʧ�ܡ�1-ִ�гɹ� 
uint16_t  UART4_GetRxNum(void);                                                 // ��ȡ���յ�������һ֡�ֽ���
uint8_t * UART4_GetRxData(void);                                                // ��ȡ���յ������� (����ĵ�ַ)
void      UART4_ClearRx(void);                                                  // �������յ������� (�������һ֡�ֽ�������Ϊ�����жϽ��յı�־)
// UART5                                                                        
void      UART5_Init(uint32_t ulBaudrate);                                      // ��ʼ������5; GPIO����PC12+PD2���ж����ȼ���ͨ�Ų����������ʿ��衢8λ���ݡ���У�顢1��ֹͣλ
void      UART5_SendData(uint8_t *puData, uint16_t usNum);                      // ����ָ������; ���������ݵ�ַ���ֽ���
void      UART5_SendString(const char *pcString, ...);                          // �����ַ���;   �������ַ�����ַ; ʹ�÷�����ͬprintf
uint8_t   UART5_SendAT(char *pcAT, char *pcAckString, uint16_t usTimeOutMs);    // �����������ESP8266������ģ���AT�̼������ڵȴ������ڴ�����Ϣ; ������ATָ���ַ������ڴ�������Ϣ�ַ�����ms�ȴ���ʱ; ���أ�0-ִ��ʧ�ܡ�1-ִ�гɹ� 
uint16_t  UART5_GetRxNum(void);                                                 // ��ȡ���յ�������һ֡�ֽ���
uint8_t * UART5_GetRxData(void);                                                // ��ȡ���յ������� (����ĵ�ַ)
void      UART5_ClearRx(void);                                                  // �������յ������� (�������һ֡�ֽ�������Ϊ�����жϽ��յı�־)
// UART6                                                                        
void      UART6_Init(uint32_t ulBaudrate);                                      // ��ʼ������6; GPIO����PC6+PC7���ж����ȼ���ͨ�Ų����������ʿ��衢8λ���ݡ���У�顢1��ֹͣλ
void      UART6_SendData(uint8_t *puData, uint16_t usNum);                      // ����ָ������; ���������ݵ�ַ���ֽ���
void      UART6_SendString(const char *pcString, ...);                          // �����ַ���;   �������ַ�����ַ; ʹ�÷�����ͬprintf
uint8_t   UART6_SendAT(char *pcAT, char *pcAckString, uint16_t usTimeOutMs);    // �����������ESP8266������ģ���AT�̼������ڵȴ������ڴ�����Ϣ; ������ATָ���ַ������ڴ�������Ϣ�ַ�����ms�ȴ���ʱ; ���أ�0-ִ��ʧ�ܡ�1-ִ�гɹ� 
uint16_t  UART6_GetRxNum(void);                                                 // ��ȡ���յ�������һ֡�ֽ���
uint8_t * UART6_GetRxData(void);                                                // ��ȡ���յ������� (����ĵ�ַ)
void      UART6_ClearRx(void);                                                  // �������յ������� (�������һ֡�ֽ�������Ϊ�����жϽ��յı�־)     

 // ����������Modbus_CRC16У��
void      Modbus_AddCRC16(uint8_t *_pcData, uint16_t _usLen);                   // ������׷��2�ֽڵ�ModbusCRC16У��ֵ��ĩβ; ������ԭʼ���ݡ�ԭʼ�����ֽ���; ע�⣺���ú�����ԭʼ���ݻ�����2�ֽ�
uint8_t   Modbus_CheckCRC16(uint8_t *_pcData, uint16_t _usLen);                 // �Դ�ModbusCRC16У������ݶν���У��; ���أ�0-����1-ƥ����ȷ;





#endif

// �ļ���β����Ҫ��������1����
